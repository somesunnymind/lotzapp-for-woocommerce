                notice.className = 'lotzwoo-menu-planning__notice';
                notice.textContent = config.i18n.tableMissing;
                root.appendChild(notice);
            }

            const tabs = document.createElement('div');
            tabs.className = 'lotzwoo-menu-planning__tabs';
            [
                { id: 'current', label: config.i18n.tabCurrent || 'Aktuelle & geplante MenÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¼plÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¤ne' },
                { id: 'history', label: config.i18n.tabHistory || 'Vergangene MenÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¼plÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¤ne' },
            ].forEach((tab) => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'lotzwoo-menu-planning__tab button' + (state.activeTab === tab.id ? ' lotzwoo-menu-planning__tab--active' : '');
                button.textContent = tab.label;
                button.addEventListener('click', () => {
                    if (state.activeTab !== tab.id) {
                        state.activeTab = tab.id;
                        render();
                    }
                });
                tabs.appendChild(button);
            });
            root.appendChild(tabs);

            if (state.activeTab === 'history') {
                renderHistorySection();
                return;
            }

            const toolbar = document.createElement('div');
            toolbar.className = 'lotzwoo-menu-planning__toolbar';

            const createButton = document.createElement('button');
            createButton.type = 'button';
            createButton.className = 'button button-primary lotzwoo-menu-planning__create';
            createButton.textContent = config.i18n.createButton;
            createButton.disabled = !state.tableExists || state.creating;
            createButton.addEventListener('click', handleCreate);
            toolbar.appendChild(createButton);

            if (state.schedule) {
                const info = document.createElement('div');
                info.className = 'lotzwoo-menu-planning__schedule-info';
                info.innerHTML = `
                    <strong>${escapeHtml(state.schedule.weekday_display || state.schedule.weekday || '')}, ${escapeHtml(state.schedule.time || '')}</strong>
                    <span>${escapeHtml(state.schedule.nextSlotDisplay || state.schedule.nextSlotLocal || '')}</span>
                `;
                toolbar.appendChild(info);
            }

            root.appendChild(toolbar);

            if (state.loading) {
                const loading = document.createElement('div');
                loading.className = 'lotzwoo-menu-planning__loading';
                loading.textContent = config.i18n.loading;
                root.appendChild(loading);
                return;
            }

            if (!state.entries.length) {
                const empty = document.createElement('div');
                empty.className = 'lotzwoo-menu-planning__empty';
                empty.textContent = config.i18n.empty;
                root.appendChild(empty);
                return;
            }

            const table = document.createElement('table');
            table.className = 'lotzwoo-menu-planning__table wp-list-table widefat striped';

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            const timeHeader = document.createElement('th');
            timeHeader.textContent = config.i18n.timeColumn;
            headerRow.appendChild(timeHeader);

            state.tags.forEach((tag) => {
                const th = document.createElement('th');
                th.textContent = tag.name || tag.slug;
                headerRow.appendChild(th);
            });

            const actionsHeader = document.createElement('th');
            actionsHeader.textContent = config.i18n.actionsColumn;
            headerRow.appendChild(actionsHeader);

            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            state.entries.forEach((entry) => {
                tbody.appendChild(renderRow(entry));
            });
            table.appendChild(tbody);

            root.appendChild(table);
        }

        function renderRow(entry) {
            const tr = document.createElement('tr');

            const timeCell = document.createElement('td');
            timeCell.className = 'lotzwoo-menu-planning__cell lotzwoo-menu-planning__cell--time';
            timeCell.innerHTML = `
                <div><strong>${escapeHtml(entry.scheduled_at_display || entry.scheduled_at_local || entry.scheduled_at_utc || '')}</strong></div>
                <div class="lotzwoo-menu-planning__status">${formatStatus(entry.status)}</div>
            `;
            tr.appendChild(timeCell);

            state.tags.forEach((tag) => {
                const cell = document.createElement('td');
                cell.className = 'lotzwoo-menu-planning__cell';
                const products = Array.isArray(tag.products) ? tag.products : [];

                if (!products.length) {
                    const placeholder = document.createElement('em');
                    placeholder.className = 'lotzwoo-menu-planning__no-products';
                    placeholder.textContent = config.i18n.noProducts || 'Keine Produkte vorhanden.';
                    cell.appendChild(placeholder);
                } else {
                    const select = document.createElement('select');
                    select.multiple = true;
                    select.dataset.placeholder = config.i18n.addProduct || 'Produkt hinzufügen';
                    products.forEach((product) => {
                        const option = document.createElement('option');
                        option.value = String(product.id);
                        option.textContent = product.name;
                        const selectedValues = entry.draftPayload[tag.slug] || [];
                        option.selected = selectedValues.includes(product.id);
                        select.appendChild(option);
                    });

                    select.disabled = entry.saving || entry.deleting;
                    cell.appendChild(select);
                    initializeTomSelect(select, entry, tag);
                }

                tr.appendChild(cell);
            });

            const actionCell = document.createElement('td');
            actionCell.className = 'lotzwoo-menu-planning__cell lotzwoo-menu-planning__cell--actions';

            const deleteButton = document.createElement('button');
            deleteButton.type = 'button';
            deleteButton.className = 'button button-link-delete';
            deleteButton.textContent = config.i18n.remove;
            deleteButton.disabled = entry.deleting || entry.saving;
            deleteButton.addEventListener('click', () => handleDelete(entry.id));

            if (entry.is_active || entry.is_current) {
                const runButton = document.createElement('button');
                runButton.type = 'button';
                runButton.className = 'button button-secondary';
                runButton.textContent = entry.runningNow ? config.i18n.applyingNow : config.i18n.applyNow;
                runButton.disabled = entry.runningNow || entry.saving || entry.deleting || !entry.dirty;
                runButton.addEventListener('click', () => handleRunNow(entry.id));
                actionCell.appendChild(runButton);
            } else {
                const saveButton = document.createElement('button');
                saveButton.type = 'button';
                saveButton.className = 'button button-secondary';
                saveButton.textContent = config.i18n.save;
                saveButton.disabled = !entry.dirty || entry.saving || entry.deleting;
                saveButton.addEventListener('click', () => handleSave(entry.id));
                actionCell.appendChild(saveButton);
            }
            actionCell.appendChild(deleteButton);

            tr.appendChild(actionCell);
            return tr;
        }
